<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Secure Client Portal • Login</title>
<style>
  :root{
    --navy:#0b2a55;
    --orange:#ff7a18;
    --muted:#6b7280;
    --radius:15px;             /* your design system */
  }
  body{
    margin:0; min-height:100svh;
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    color:#111827;
    background:
      radial-gradient(40% 50% at 15% 10%, rgba(11,42,85,.12), transparent 60%),
      radial-gradient(35% 45% at 90% 85%, rgba(255,122,24,.14), transparent 65%),
      #fff;
    display:grid; place-items:center; padding:24px;
  }
  .card{
    width:min(520px, 94vw);
    background:#fff;
    border:1px solid rgba(11,42,85,.08);
    border-radius:22px;
    box-shadow: 0 14px 36px rgba(11,42,85,.10), 0 2px 10px rgba(11,42,85,.05);
    overflow:hidden;
  }
  header{ padding:34px 28px 0; text-align:center; }
  .logo{
    width:64px;height:64px;border-radius:18px;margin:0 auto 14px;
    display:grid;place-items:center;background:#fff;border:1px solid #e5e7eb;
    box-shadow: inset 0 2px 6px rgba(0,0,0,.04);
    color:var(--navy);font-weight:800;letter-spacing:.03em;
  }
  h1{ margin:6px 0 10px; font-size: clamp(24px,3vw,32px); }
  .sub{ margin:0 auto 22px; max-width:56ch; color:var(--muted); font-size:15px; line-height:1.45; }
  form{ padding: 16px 28px 26px; }
  .field{ margin: 12px 0; }
  .field input{
    width:100%; padding:14px 16px; border-radius: var(--radius);
    border:1px solid #e5e7eb; background:#f3f4f6; font-size:16px; outline:none;
    transition: border-color .15s, box-shadow .15s, background .15s;
  }
  .field input:focus{ background:#fff; border-color:#93c5fd; box-shadow: 0 0 0 4px rgba(59,130,246,.15); }
  .row{ display:flex; justify-content:flex-end; margin-top:6px; }
  .row a{ font-size:14px; color: var(--navy); text-decoration:none; }
  .row a:hover{ text-decoration:underline; }
  .btn{
    width:100%; padding:16px; margin-top:10px; border-radius: var(--radius);
    background:#000; color:#fff; font-weight:900; letter-spacing:.08em;
    text-transform:uppercase; border:0; cursor:pointer;
    box-shadow: 0 10px 24px rgba(0,0,0,.2);
  }
  .btn:hover{ opacity:.95; }
  .divider{ color:#94a3b8; text-align:center; margin:16px 0 10px; font-size:13px; }
  .providers{ display:grid; gap:12px; padding: 0 28px 26px; }
  .provider{
    display:flex; align-items:center; justify-content:center; gap:10px;
    border:1px solid #e5e7eb; background:#fff; border-radius: var(--radius);
    padding:12px; cursor:pointer; transition: border-color .2s, box-shadow .2s, transform .05s;
  }
  .provider:hover{ border-color: var(--navy); box-shadow: 0 8px 18px rgba(255,122,24,.12); }
  .provider:active{ transform: translateY(1px); }
  .fineprint{ text-align:center; color:#9aa0a6; font-size:12px; padding-bottom: 20px; }
</style>
</head>
<body>
  <main class="card" role="main">
    <header>
      <div class="logo">LOGO</div>
      <h1>Secure Client Portal</h1>
      <p class="sub">
        View your account information, send/request updates on your matter, store important legal documents,
        manage or pay your bills and view your transaction history. More features coming soon.
      </p>
    </header>

    <form id="login-form" novalidate>
      <div class="field"><input id="email" type="email" placeholder="Email" autocomplete="username" required></div>
      <div class="field"><input id="password" type="password" placeholder="Password" autocomplete="current-password" required></div>
      <div class="row"><a href="#" id="forgot">Forgot password?</a></div>
      <button class="btn" type="submit">GET STARTED</button>
    </form>

    <div class="divider">Or sign in with</div>
    <section class="providers">
      <!-- Google button container (rendered by GIS SDK) -->
      <div id="g_id_onload"
        data-client_id=""
        data-context="signin"
        data-ux_mode="popup"
        data-callback="handleGoogle"
        data-auto_prompt="false"></div>
      <div class="provider">
        <div class="g_id_signin" data-type="standard" data-shape="rectangular" data-theme="outline" data-text="signin_with" data-size="large" data-logo_alignment="left" style="width:100%"></div>
      </div>

      <!-- Facebook -->
      <button id="facebookBtn" class="provider" type="button">Continue with Facebook</button>

      <!-- Apple -->
      <button id="appleBtn" class="provider" type="button">Sign in with Apple</button>
    </section>

    <p class="fineprint">By continuing you agree to our Terms and Privacy Policy.</p>
  </main>

  <!-- Google Identity Services -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <!-- Facebook SDK -->
  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

  <!-- Apple Sign In JS -->
  <script src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js"></script>

  <script>
    // Attach IDs from server-side .env to the page at runtime (optional: for local dev you can inline them)
    const ENV = {
      GOOGLE_CLIENT_ID: `<?= process?.env?.GOOGLE_CLIENT_ID ?? '' ?>` // if served by templating; otherwise fill in below
    };
  </script>

  <script>
    // Fill Google client id at runtime if not provided by server templating:
    const gOnload = document.getElementById('g_id_onload');
    if (gOnload && !gOnload.dataset.client_id) {
      gOnload.dataset.clientId = '<?= process?.env?.GOOGLE_CLIENT_ID ?? "" ?>';
    }

    // Google callback -> send ID token to backend
    window.handleGoogle = async function (response) {
      try {
        const r = await fetch('/api/auth/google', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ credential: response.credential })
        });
        const data = await r.json();
        if (!data.ok) throw new Error(data.message || 'Google login failed');
        alert('Signed in with Google ✔️');
        location.href = '/';
      } catch (e) {
        alert(e.message);
      }
    };

    // Facebook init then login
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '<?= process?.env?.FACEBOOK_APP_ID ?? "YOUR_FACEBOOK_APP_ID" ?>',
        cookie     : true,
        xfbml      : true,
        version    : 'v18.0'
      });
    };

    document.getElementById('facebookBtn').addEventListener('click', function(){
      FB.login(async function(resp){
        if (resp.authResponse) {
          try {
            const r = await fetch('/api/auth/facebook', {
              method:'POST',
              headers:{'Content-Type':'application/json'},
              body: JSON.stringify({ accessToken: resp.authResponse.accessToken })
            });
            const data = await r.json();
            if (!data.ok) throw new Error(data.message || 'Facebook login failed');
            alert('Signed in with Facebook ✔️');
            location.href = '/';
          } catch(e){ alert(e.message); }
        }
      }, { scope: 'public_profile,email' });
    });

    // Apple popup login
    AppleID.auth.init({
      clientId: 'YOUR_APPLE_CLIENT_ID',  // same as APPLE_CLIENT_ID in .env
      scope: 'name email',
      redirectURI: window.location.origin + '/', // not used in popup, but required
      usePopup: true
    });

    document.getElementById('appleBtn').addEventListener('click', async () => {
      try {
        const res = await AppleID.auth.signIn(); // { authorization: { code, id_token } ... }
        const { code, id_token } = res.authorization || {};
        const r = await fetch('/api/auth/apple', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code, id_token })
        });
        const data = await r.json();
        if (!data.ok) throw new Error(data.message || 'Apple login failed');
        alert('Signed in with Apple ✔️');
        location.href = '/';
      } catch (e) {
        if (e && e.error === 'popup_closed_by_user') return;
        alert(e.message || 'Apple sign-in error');
      }
    });

    // Demo form submit (replace with your email/password auth later)
    document.getElementById('login-form').addEventListener('submit', (e) => {
      e.preventDefault();
      alert('Hook this form to your username/password auth.');
    });
  </script>
</body>
</html>
